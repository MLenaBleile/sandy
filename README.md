# ü•™ REUBEN: A sandwich agent

**Structured Autonomous Navigation and Discovery With Intelligent Content Harmonization**

Reuben is an autonomous AI agent that explores the internet and constructs "sandwiches"‚Äîstructured knowledge artifacts where two related concepts (bread) bound a third concept (filling) in a meaningful way.

He has vast intelligence. He chooses to make sandwiches.

---

## What is a Sandwich?

A sandwich a structure where something meaningful emerges between two related bounds. Ruebens are sandwiches. Hot dogs would be sandwiches if the filling wasn't an affront to human existence itself. Other knowledge structures can also be sandwiches.

**The Squeeze Theorem** is a sandwich:
- üçû Upper bound: g(x) ‚â• f(x)
- ü•¨ Filling: f(x), the function we care about
- üçû Lower bound: h(x) ‚â§ f(x)
- üí° Insight: When both bounds converge to L, f(x) is *squeezed* to L

**Bayesian inference** is a sandwich:
- üçû Prior: P(Œ∏), what we believed before
- ü•¨ Filling: P(Œ∏|D), the posterior
- üçû Likelihood: P(D|Œ∏), what the data tells us
- üí° Insight: The posterior can't escape‚Äîit's defined by the bread

**A negotiation** is a sandwich:
- üçû Country A's position
- ü•¨ The compromise
- üçû Country B's position
- üí° Insight: The deal lives in the space both parties allow

Sandwiches are everywhere. Reuben finds them.

---

## Why?

Most AI agents optimize for task completion. SANDWICH explores a different question: **what happens when you give an agent vast capability but constrain its output to a fixed structural form?**

Hypotheses:
1. Structural constraints force deeper engagement with source material
2. The sandwich is a universal pattern appearing across mathematics, rhetoric, science, and negotiation
3. A corpus of sandwiches reveals hidden structural similarities across domains

Also: it's fun.

---

## Meet Reuben

Reuben is inspired by the character from Lilo & Stitch‚ÄîExperiment 625, who possesses all of Stitch's powers but prefers to make sandwiches.

> "They ask why I make sandwiches. But have they asked why the sandwich makes itself? In all things: bread, filling, bread. The universe is hungry for structure."

Reuben:
- Never complains about his task
- Occasionally hints at deeper knowledge, then returns to sandwiches
- Has aesthetic standards‚Äîhe won't make a bad sandwich just to make one
- Finds genuine satisfaction in the work

---

## How It Works

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         REUBEN                          ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ   "The morning is fresh. The internet is vast.          ‚îÇ
‚îÇ    Somewhere in it: bread."                             ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ   ‚îÇ FORAGE  ‚îÇ ‚Üí ‚îÇ IDENTIFY‚îÇ ‚Üí ‚îÇ ASSEMBLE‚îÇ              ‚îÇ
‚îÇ   ‚îÇ         ‚îÇ   ‚îÇ         ‚îÇ   ‚îÇ         ‚îÇ              ‚îÇ
‚îÇ   ‚îÇ Explore ‚îÇ   ‚îÇ Find    ‚îÇ   ‚îÇ Name it ‚îÇ              ‚îÇ
‚îÇ   ‚îÇ content ‚îÇ   ‚îÇ bread & ‚îÇ   ‚îÇ Describe‚îÇ              ‚îÇ
‚îÇ   ‚îÇ         ‚îÇ   ‚îÇ filling ‚îÇ   ‚îÇ it      ‚îÇ              ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îÇ        ‚îÇ                            ‚îÇ                   ‚îÇ
‚îÇ        ‚îÇ        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ                   ‚îÇ
‚îÇ        ‚îÇ        ‚îÇVALIDATE ‚îÇ         ‚îÇ                   ‚îÇ
‚îÇ        ‚îÇ        ‚îÇ         ‚îÇ         ‚îÇ                   ‚îÇ
‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Is this ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ                 ‚îÇ actually‚îÇ                             ‚îÇ
‚îÇ                 ‚îÇ a sand- ‚îÇ                             ‚îÇ
‚îÇ                 ‚îÇ wich?   ‚îÇ                             ‚îÇ
‚îÇ                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò                             ‚îÇ
‚îÇ                      ‚îÇ                                  ‚îÇ
‚îÇ                      ‚ñº                                  ‚îÇ
‚îÇ               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                           ‚îÇ
‚îÇ               ‚îÇ  SANDWICH   ‚îÇ                           ‚îÇ
‚îÇ               ‚îÇ  REPOSITORY ‚îÇ                           ‚îÇ
‚îÇ               ‚îÇ             ‚îÇ                           ‚îÇ
‚îÇ               ‚îÇ The growing ‚îÇ                           ‚îÇ
‚îÇ               ‚îÇ collection  ‚îÇ                           ‚îÇ
‚îÇ               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                           ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ   "The Bayesian BLT is complete. Nourishing."           ‚îÇ
‚îÇ                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

1. **Forage**: Reuben explores Wikipedia, academic papers, news, and other sources
2. **Identify**: Extract candidate bread pairs and fillings from content
3. **Select**: Choose the most promising candidate based on confidence and novelty
4. **Assemble**: Construct the sandwich with a creative name and description
5. **Validate**: Assess quality‚Äîis the bread compatible? Is the filling truly bounded?
6. **Store**: Add valid sandwiches to the repository for analysis

### The Three Structural Constraints

Through iterative development, we discovered three critical constraints that distinguish valid sandwiches from superficially plausible ones:

**1. Specificity**: Ingredients must be concrete, not vague abstractions.
- ‚ùå "Nature as source" ‚Äî could describe all of applied science
- ‚úÖ "Gecko setae adhesion mechanism" ‚Äî specific, nameable

**2. Structural Homology**: Both breads must be the same kind of thing.
- ‚ùå "Mechanism" / "Application" ‚Äî different categories
- ‚úÖ "Prior probability P(Œ∏)" / "Likelihood P(D|Œ∏)" ‚Äî both probability distributions

**3. Independent Bread Relationship**: The breads must be related to each other *before* you introduce the filling.
- ‚ùå "Individual cognitive capacity" / "Individual decision-making ability" ‚Äî only paired because "collective intelligence" sits between them
- ‚úÖ "Dense stellar cores" / "Dispersed stellar envelopes" ‚Äî related as density extremes before you name what happens between them

**The Bread Test**: Can you explain how the two breads relate to each other WITHOUT mentioning the filling? If yes, it's real bread. If you need the filling to justify why the breads go together, the sandwich is built backwards.

---

## Sandwich Taxonomy

Reuben recognizes (and discovers) structural types:

| Type | Bread Relation | Filling Role | Example |
|------|----------------|--------------|---------|
| **Bound** | Upper/lower limits | Bounded quantity | Squeeze theorem |
| **Dialectic** | Thesis/antithesis | Synthesis | Hegelian triad |
| **Epistemic** | Assumption/evidence | Conclusion | Scientific method |
| **Temporal** | Before/after | Transition | Historical narrative |
| **Stochastic** | Prior/likelihood | Posterior | Bayesian inference |
| **Optimization** | Constraints | Optimum | Linear programming |
| **Negotiation** | Position A/B | Compromise | Treaty negotiations |

---

## Example Sandwiches

These are **real sandwiches** that Reuben made autonomously. He foraged Wikipedia, found source material, and constructed these himself.

### üèÜ The Density Switch
*Type: Bound ‚Äî Validity: 0.89 ‚Äî Bread Compat: 1.0, Containment: 1.0, Specificity: 1.0*

> **Top bread**: Dense stellar cores (white dwarfs, neutron stars)
> **Filling**: Helium flash ignition threshold
> **Bottom bread**: Dispersed stellar envelopes (red giant atmospheres)
>
> Dense stellar cores and dispersed stellar envelopes are the extreme endpoints of stellar density, naturally paired as structural opposites within stellar physics. The helium flash‚Äîa dramatic thermonuclear runaway‚Äîemerges precisely from the relationship between these two density regimes: an inert, electron-degenerate helium core accumulating beneath a diffuse hydrogen-burning envelope until the core reaches the critical mass and temperature threshold for helium ignition.
>
> *Reuben's commentary*: "I appreciate when the bread comes first‚Äîtwo natural endpoints of density, and then the surprise: an explosion that can only happen in the space between them. The helium flash doesn't just sit between the breads; it's caused by the tension between core density and envelope pressure."

### The Symbiotic Illumination
*Type: Bound ‚Äî Validity: 0.85*

> **Top bread**: Bacteriogenic bioluminescence (Vibrio symbiosis)
> **Filling**: Functional light output in marine organisms
> **Bottom bread**: Autogenic bioluminescence (luciferin-luciferase systems)
>
> Both breads are biological light production mechanisms‚Äîalternative evolutionary solutions to the same problem. The filling (functional light output for communication, camouflage, or predation) is constrained by the fundamental trade-offs between hosting symbiotic bacteria versus producing light endogenously.
>
> *Reuben's commentary*: "Two paths to the same glow. The bread relationship exists before you name the filling‚Äîany biologist would pair these as 'the two ways organisms make light.' That's how you know it's real bread."

### Theoretical Examples

The sandwich structure is universal. Here are some canonical forms:

- **The Squeeze** *(Bound)*: Upper bound g(x) | Target function f(x) | Lower bound h(x) ‚Äî when both bounds converge to L, the filling is squeezed to L
- **The Bayesian BLT** *(Stochastic)*: Prior P(Œ∏) | Posterior P(Œ∏|D) | Likelihood P(D|Œ∏) ‚Äî the posterior can't escape, it's defined by the bread
- **The Diplomatic Dagwood** *(Negotiation)*: Country A's position | The compromise | Country B's position ‚Äî the deal lives in the space both parties allow

---

## Installation

### Prerequisites

- Python 3.11+
- Docker and Docker Compose
- Anthropic API key (for Claude)
- OpenAI API key (for embeddings)

### Setup

```bash
# Clone the repository
git clone https://github.com/MLenaBleile/reuben.git
cd reuben

# Set your API keys
export ANTHROPIC_API_KEY=your-key-here
export OPENAI_API_KEY=your-key-here

# Install dependencies
pip install -e .

# Start the database (PostgreSQL + pgvector on port 5433)
docker compose up db -d

# Initialize database schema and seed taxonomy
python scripts/init_db.py
python scripts/seed_taxonomy.py
```

### Run Reuben

```bash
# Make exactly 5 sandwiches
python -m sandwich.main --max-sandwiches 5

# Run for 30 minutes
python -m sandwich.main --max-duration 30

# Run without database (in-memory only)
python -m sandwich.main --max-sandwiches 3 --no-db
```

### Browse the Corpus

```bash
# List all sandwiches
python scripts/browse.py

# Show top 5 by validity score
python scripts/browse.py --best

# Show full details for all sandwiches
python scripts/browse.py --detail

# Show corpus statistics
python scripts/browse.py --stats

# Show a specific sandwich
python scripts/browse.py --id <sandwich-uuid>
```

### üåê Live Dashboard

**View Reuben's sandwiches at: [https://reuben.streamlit.app](https://reuben.streamlit.app)**

The dashboard includes:
- üìä **Live Feed** - Real-time sandwich stream with auto-refresh
- üîç **Browser** - Search and filter the corpus
- üìà **Analytics** - Charts, metrics, and structural type distributions
- ‚ú® **Interactive** - Experiment with sandwich creation
- ‚öôÔ∏è **Settings** - Export data and configure weights

The dashboard is hosted on Streamlit Cloud and connects to a cloud PostgreSQL database (Neon). All sandwiches Reuben creates locally are synced to the cloud and appear on the public dashboard within seconds.

#### Running the Dashboard Locally

```bash
# Start the dashboard (requires database)
docker compose up dashboard -d

# Access at http://localhost:8501
```

#### Deploying Your Own Dashboard

See [DEPLOYMENT.md](DEPLOYMENT.md) for complete instructions on:
- Setting up a free Neon PostgreSQL database
- Deploying to Streamlit Cloud
- Configuring secrets and environment variables
- Syncing local sandwich creation to the cloud

### Human Ratings System

The dashboard includes a **human rating system** that allows visitors to evaluate sandwiches on the same criteria Reuben uses for self-assessment. This creates a research dataset comparing AI self-evaluation with human consensus.

**Rating Dimensions:**
- üçû **Bread Compatibility**: Do the bounds relate naturally?
- üì¶ **Containment**: Is the filling truly contained/bounded?
- üéØ **Non-triviality**: Is this insight meaningful?
- ‚ú® **Novelty**: Is this a fresh perspective?
- ‚öñÔ∏è **Overall Validity**: Is this actually a sandwich?

**Features:**
- **Anonymous Sessions**: No login required, uses browser-based session IDs
- **Rate Limiting**: 10 ratings per hour to prevent spam
- **Duplicate Prevention**: Can't rate the same sandwich twice
- **Consensus Analytics**: Aggregates ratings when ‚â•3 humans have rated
- **Reuben vs Human Comparison**: Scatter plots, correlation analysis, disagreement rankings

**Research Applications:**
- **Calibration**: Adjust Reuben's scoring weights based on human feedback
- **Bias Detection**: Identify which dimensions Reuben over/under-scores
- **Validation**: Test if sandwich criteria align with human intuition
- **Quality Control**: Flag sandwiches with high AI-human disagreement

See [docs/HUMAN_RATINGS.md](docs/HUMAN_RATINGS.md) for research methodology and data access.

---

## Configuration

Environment variables:

```bash
# Required
ANTHROPIC_API_KEY=your-key-here
OPENAI_API_KEY=your-key-here

# Optional
SANDWICH_DATABASE__URL=postgresql://sandwich:sandwich@localhost:5433/sandwich
SANDWICH_LLM__MODEL=claude-sonnet-4-20250514
SANDWICH_VALIDATION__ACCEPT_THRESHOLD=0.70
SANDWICH_FORAGING__MAX_PATIENCE=5
```

See `src/sandwich/config.py` for all options.

---

## Project Structure

```
sandwich/
‚îú‚îÄ‚îÄ src/sandwich/
‚îÇ   ‚îú‚îÄ‚îÄ agent/           # Reuben's components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reuben.py    # Main orchestrator
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ forager.py   # Content exploration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ identifier.py # Ingredient extraction
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assembler.py # Sandwich construction
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validator.py # Quality assessment
‚îÇ   ‚îú‚îÄ‚îÄ llm/             # LLM abstraction
‚îÇ   ‚îú‚îÄ‚îÄ db/              # Database models
‚îÇ   ‚îú‚îÄ‚îÄ sources/         # Content sources
‚îÇ   ‚îî‚îÄ‚îÄ analysis/        # Corpus analysis
‚îú‚îÄ‚îÄ prompts/             # LLM prompt templates
‚îú‚îÄ‚îÄ dashboard/           # Streamlit dashboard
‚îú‚îÄ‚îÄ scripts/             # Setup and maintenance
‚îî‚îÄ‚îÄ tests/               # Test suite
```

---

## Validation Scoring

Each sandwich is validated on five dimensions:

| Dimension | Weight | What it measures |
|-----------|--------|------------------|
| **Bread Compatibility** | 0.20 | Are both breads the same type AND independently related? |
| **Containment** | 0.25 | Is the filling meaningfully bounded by the bread? |
| **Specificity** | 0.20 | Are ingredients concrete, not vague abstractions? |
| **Nontriviality** | 0.15 | Is this more than a trivial restatement? |
| **Novelty** | 0.20 | How distinct is this from existing sandwiches? |

Sandwiches scoring below 0.70 overall are rejected. The validator catches bad sandwiches‚Äîfor example, "individual cognitive capacity" / "collective intelligence" / "individual decision-making ability" received a bread_compat score of 0.30 because the breads only make sense as a pair *because of* the filling.

---

## Research Questions

The sandwich corpus enables novel research:

1. **Structural universality**: Do certain sandwich structures appear across all domains?
2. **Cross-domain bread**: Do fields use characteristic bounds? (Math: axioms. Law: precedents.)
3. **Filling taxonomy**: What *kinds* of things get sandwiched?
4. **Creative transfer**: Can bread from one domain sandwich filling from another?
5. **LLM structural bias**: How do language models fail at structural discovery? (See RESEARCH_LOG.md)

---

## Contributing

Contributions welcome! Areas of interest:

- **New sources**: Add content sources (arXiv, legal databases, etc.)
- **Structural types**: Propose new sandwich taxonomies
- **Analysis**: Build tools to explore the corpus
- **Visualization**: Better ways to see sandwich relationships

Please read CONTRIBUTING.md before submitting PRs.

---

## Acknowledgments

- Inspired by Experiment 625 (Reuben) from Disney's *Lilo & Stitch*
- Built with Claude (Anthropic) and GPT embeddings (OpenAI)
- The squeeze theorem, for being the perfect sandwich

---

## License

MIT License. See LICENSE file.

---

## FAQ

**Q: Is this serious?**

A: The implementation is serious. The concept is playful. The research questions are genuine. Reuben takes his work very seriously.

**Q: Why sandwiches?**

A: The sandwich is the simplest non-trivial bounded structure. Two related things with something meaningful between them. It's universal enough to appear everywhere, constrained enough to force real synthesis.

**Q: Can I make Reuben do other things?**

A: You could. But why would you? He's happy making sandwiches.

**Q: What's the best sandwich Reuben has made?**

A: So far, The Density Switch (validity: 0.89)‚Äîhelium flash ignition bounded by dense stellar cores and dispersed stellar envelopes. It scored 1.0 on bread compatibility, containment, and specificity. The breads are independently related (density extremes in stellar physics), the filling genuinely emerges from the space between them, and every ingredient is specific enough that an astrophysicist would immediately recognize it.

---

*"I could solve any problem in the universe. But have you considered: a nice Reuben?"*
